{% extends "base.html" %}

{% block title %}SafeFactory - AI ê¸°ë°˜ ì‚°ì—…ì•ˆì „ ì§€ì‹ í”Œë«í¼{% endblock %}
{% block nav_home %}active{% endblock %}
{% block mobile_nav_home %}active{% endblock %}

{% block head_extra %}
<style>
    /* ===== Hero Section ===== */
    .hero {
        text-align: center;
        padding: 56px 24px 32px;
        position: relative;
    }
    .hero::before {
        content: '';
        position: absolute;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 600px;
        height: 400px;
        background: radial-gradient(ellipse, rgba(124,58,237,0.12) 0%, transparent 70%);
        pointer-events: none;
    }
    .hero-badge {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        background: rgba(167,139,250,0.1);
        border: 1px solid rgba(167,139,250,0.2);
        border-radius: 20px;
        padding: 6px 16px;
        font-size: 12px;
        font-weight: 500;
        color: var(--sf-purple-lighter);
        margin: 0 auto 20px;
        width: fit-content;
    }
    .hero-badge .pulse {
        width: 6px;
        height: 6px;
        background: #22c55e;
        border-radius: 50%;
        animation: pulse-glow 2s infinite;
    }
    @keyframes pulse-glow {
        0%, 100% { box-shadow: 0 0 0 0 rgba(34,197,94,0.4); }
        50% { box-shadow: 0 0 0 6px rgba(34,197,94,0); }
    }
    .hero-title {
        font-size: 42px;
        font-weight: 900;
        background: linear-gradient(135deg, var(--sf-purple-lighter), var(--sf-purple-light), var(--sf-purple));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin: 0 auto 14px;
        line-height: 1.25;
        text-align: center;
    }
    .hero-subtitle {
        font-size: 16px;
        color: var(--sf-text-3);
        font-weight: 400;
        line-height: 1.7;
        margin-bottom: 32px;
        text-align: center;
    }
    .hero-subtitle strong {
        color: var(--sf-text-2);
        font-weight: 600;
    }

    /* ===== Unified Search Bar ===== */
    .search-container {
        max-width: 720px;
        margin: 0 auto 16px;
    }
    .unified-search {
        display: flex;
        align-items: center;
        background: var(--sf-card-bg);
        border: 2px solid var(--sf-border-light);
        border-radius: 18px;
        padding: 6px 6px 6px 18px;
        transition: border-color 0.3s, box-shadow 0.3s;
        gap: 8px;
    }
    .unified-search:focus-within {
        border-color: var(--sf-purple);
        box-shadow: 0 0 30px rgba(124,58,237,0.15);
    }
    .search-icon { font-size: 20px; flex-shrink: 0; }
    .search-input {
        flex: 1;
        background: transparent;
        border: none;
        outline: none;
        font-size: 15px;
        color: var(--sf-text-1);
        padding: 12px 0;
        font-family: inherit;
        min-width: 0;
    }
    .search-input::placeholder { color: var(--sf-text-4); }

    .search-domain-select {
        display: flex;
        align-items: center;
        gap: 4px;
        background: rgba(167,139,250,0.1);
        border: 1px solid rgba(167,139,250,0.2);
        border-radius: 8px;
        padding: 6px 10px;
        font-size: 12px;
        color: var(--sf-purple-lighter);
        font-weight: 500;
        flex-shrink: 0;
        cursor: pointer;
        transition: background 0.2s;
        font-family: inherit;
        position: relative;
    }
    .search-domain-select:hover { background: rgba(167,139,250,0.2); }
    .search-domain-select select {
        position: absolute;
        inset: 0;
        opacity: 0;
        cursor: pointer;
        font-size: 14px;
    }

    .search-submit {
        width: 44px;
        height: 44px;
        border-radius: 14px;
        background: linear-gradient(135deg, var(--sf-purple), var(--sf-purple-dark));
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        cursor: pointer;
        flex-shrink: 0;
        transition: transform 0.2s;
        color: #fff;
    }
    .search-submit:hover { transform: scale(1.05); }

    .search-hints {
        display: flex;
        justify-content: center;
        gap: 8px;
        flex-wrap: wrap;
        margin-top: 12px;
    }
    .search-hint {
        font-size: 12px;
        color: var(--sf-text-4);
        background: rgba(255,255,255,0.03);
        border: 1px solid var(--sf-border-light);
        padding: 5px 12px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
    }
    .search-hint:hover {
        border-color: rgba(124,58,237,0.3);
        color: var(--sf-purple-light);
        background: rgba(124,58,237,0.05);
    }

    /* ===== Stats Bar ===== */
    .stats-bar {
        display: flex;
        justify-content: center;
        gap: 40px;
        padding: 24px 0 0;
        margin-bottom: 48px;
    }
    .stat-item { text-align: center; }
    .stat-value {
        font-size: 24px;
        font-weight: 800;
        background: linear-gradient(135deg, var(--sf-purple-lighter), var(--sf-purple-light));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    .stat-label { font-size: 12px; color: var(--sf-text-4); margin-top: 2px; }

    /* ===== Domain Cards ===== */
    .domains-section {
        max-width: 1280px;
        margin: 0 auto;
        padding: 0 24px 48px;
    }
    .section-title {
        font-size: 20px;
        font-weight: 700;
        color: var(--sf-text-1);
        margin-bottom: 20px;
    }
    .domain-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 16px;
    }
    .domain-card {
        background: var(--sf-card-bg);
        border: 1px solid var(--sf-border);
        border-radius: 20px;
        padding: 0;
        cursor: pointer;
        transition: all 0.3s;
        position: relative;
        overflow: hidden;
        text-decoration: none;
        color: inherit;
        display: block;
    }
    .domain-card-bar {
        height: 3px;
        border-radius: 20px 20px 0 0;
        opacity: 0;
        transition: opacity 0.3s;
    }
    .domain-card:hover {
        border-color: transparent;
        transform: translateY(-4px);
        box-shadow: 0 12px 40px rgba(0,0,0,0.4);
    }
    .domain-card:hover .domain-card-bar { opacity: 1; }

    .domain-card-body { padding: 26px 22px; }

    .card-top {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 14px;
    }
    .card-icon-wrap {
        width: 50px;
        height: 50px;
        border-radius: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
    }
    .card-doc-count {
        font-size: 11px;
        color: var(--sf-text-4);
        background: rgba(255,255,255,0.03);
        border: 1px solid var(--sf-border);
        border-radius: 8px;
        padding: 4px 10px;
    }
    .card-doc-count .num {
        color: var(--sf-purple-light);
        font-weight: 700;
    }

    .card-title {
        font-size: 18px;
        font-weight: 700;
        margin-bottom: 6px;
    }
    .card-desc {
        font-size: 13px;
        color: var(--sf-text-3);
        line-height: 1.6;
        margin-bottom: 14px;
        min-height: 42px;
    }
    .card-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-bottom: 16px;
    }
    .card-tag {
        font-size: 11px;
        font-weight: 500;
        padding: 4px 11px;
        border-radius: 8px;
        transition: filter 0.2s;
    }
    .card-tag:hover { filter: brightness(1.3); }

    .card-action {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding-top: 14px;
        border-top: 1px solid var(--sf-border);
    }
    .card-action-label {
        font-size: 13px;
        font-weight: 600;
        color: var(--sf-text-2);
    }
    .card-action-arrow {
        font-size: 16px;
        color: var(--sf-text-4);
        transition: transform 0.2s, color 0.2s;
    }
    .domain-card:hover .card-action-arrow {
        transform: translateX(4px);
        color: var(--sf-purple-light);
    }

    /* Domain color variants */
    .dc-semi .domain-card-bar { background: linear-gradient(90deg, var(--sf-blue), #60a5fa); }
    .dc-semi:hover { box-shadow: 0 12px 40px rgba(59,130,246,0.1); }
    .dc-semi .card-icon-wrap { background: rgba(59,130,246,0.12); }
    .dc-semi .card-title { color: #60a5fa; }
    .dc-semi .card-tag { background: rgba(59,130,246,0.1); color: #93c5fd; border: 1px solid rgba(59,130,246,0.15); }

    .dc-labor .domain-card-bar { background: linear-gradient(90deg, var(--sf-amber), #fbbf24); }
    .dc-labor:hover { box-shadow: 0 12px 40px rgba(245,158,11,0.1); }
    .dc-labor .card-icon-wrap { background: rgba(245,158,11,0.12); }
    .dc-labor .card-title { color: #fbbf24; }
    .dc-labor .card-tag { background: rgba(245,158,11,0.1); color: #fde68a; border: 1px solid rgba(245,158,11,0.15); }

    .dc-field .domain-card-bar { background: linear-gradient(90deg, var(--sf-red), #f87171); }
    .dc-field:hover { box-shadow: 0 12px 40px rgba(239,68,68,0.1); }
    .dc-field .card-icon-wrap { background: rgba(239,68,68,0.12); }
    .dc-field .card-title { color: #f87171; }
    .dc-field .card-tag { background: rgba(239,68,68,0.1); color: #fca5a5; border: 1px solid rgba(239,68,68,0.15); }

    .dc-safe .domain-card-bar { background: linear-gradient(90deg, var(--sf-violet), #a78bfa); }
    .dc-safe:hover { box-shadow: 0 12px 40px rgba(139,92,246,0.1); }
    .dc-safe .card-icon-wrap { background: rgba(139,92,246,0.12); }
    .dc-safe .card-title { color: var(--sf-purple-lighter); }
    .dc-safe .card-tag { background: rgba(139,92,246,0.1); color: var(--sf-purple-lighter); border: 1px solid rgba(139,92,246,0.15); }

    .dc-msds .domain-card-bar { background: linear-gradient(90deg, var(--sf-green), #34d399); }
    .dc-msds:hover { box-shadow: 0 12px 40px rgba(16,185,129,0.1); }
    .dc-msds .card-icon-wrap { background: rgba(16,185,129,0.12); }
    .dc-msds .card-title { color: #34d399; }
    .dc-msds .card-tag { background: rgba(16,185,129,0.1); color: #6ee7b7; border: 1px solid rgba(16,185,129,0.15); }

    .dc-comm .domain-card-bar { background: linear-gradient(90deg, var(--sf-cyan), #22d3ee); }
    .dc-comm:hover { box-shadow: 0 12px 40px rgba(6,182,212,0.1); }
    .dc-comm .card-icon-wrap { background: rgba(6,182,212,0.12); }
    .dc-comm .card-title { color: #22d3ee; }
    .dc-comm .card-tag { background: rgba(6,182,212,0.1); color: #67e8f9; border: 1px solid rgba(6,182,212,0.15); }

    /* ===== Bottom Row ===== */
    .bottom-row {
        max-width: 1280px;
        margin: 0 auto;
        padding: 0 24px 48px;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
    }
    .bottom-card {
        background: var(--sf-card-bg);
        border: 1px solid var(--sf-border);
        border-radius: 20px;
        padding: 26px 22px;
    }
    .bottom-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
    }
    .bottom-card-title {
        font-size: 16px;
        font-weight: 700;
        color: var(--sf-text-1);
    }
    .view-all {
        font-size: 12px;
        color: var(--sf-purple);
        font-weight: 500;
        text-decoration: none;
        transition: color 0.2s;
    }
    .view-all:hover { color: var(--sf-purple-light); }

    /* Community Preview */
    .comm-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 0;
        border-bottom: 1px solid var(--sf-border);
        text-decoration: none;
        color: inherit;
        transition: background 0.2s;
    }
    .comm-item:last-child { border-bottom: none; }
    .comm-badge {
        font-size: 10px;
        font-weight: 600;
        padding: 3px 10px;
        border-radius: 6px;
        flex-shrink: 0;
        white-space: nowrap;
    }
    .cb-q { background: rgba(34,197,94,0.1); color: #4ade80; }
    .cb-i { background: rgba(234,179,8,0.1); color: #fbbf24; }
    .cb-f { background: rgba(59,130,246,0.1); color: #60a5fa; }
    .cb-n { background: rgba(239,68,68,0.1); color: #f87171; }
    .comm-text {
        flex: 1;
        font-size: 13px;
        color: #d4d4d8;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    .comm-meta {
        font-size: 11px;
        color: var(--sf-text-4);
        flex-shrink: 0;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    .comm-empty {
        text-align: center;
        padding: 24px 0;
        font-size: 13px;
        color: var(--sf-text-4);
    }

    /* News Preview */
    .news-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 0;
        border-bottom: 1px solid var(--sf-border);
        text-decoration: none;
        color: inherit;
        transition: background 0.2s;
    }
    .news-item:last-child { border-bottom: none; }
    .news-cat {
        font-size: 10px;
        font-weight: 600;
        padding: 3px 10px;
        border-radius: 6px;
        flex-shrink: 0;
        white-space: nowrap;
    }
    .nc-accident { background: rgba(239,68,68,0.1); color: #f87171; }
    .nc-regulation { background: rgba(234,179,8,0.1); color: #fbbf24; }
    .nc-policy { background: rgba(59,130,246,0.1); color: #60a5fa; }
    .nc-technology { background: rgba(34,197,94,0.1); color: #4ade80; }
    .nc-general { background: rgba(167,139,250,0.1); color: #a78bfa; }
    .news-text {
        flex: 1;
        font-size: 13px;
        color: #d4d4d8;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    .news-meta {
        font-size: 11px;
        color: var(--sf-text-4);
        flex-shrink: 0;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    /* ===== Footer ===== */
    .sf-footer {
        max-width: 1280px;
        margin: 0 auto;
        padding: 0 24px;
    }
    .sf-footer-inner {
        border-top: 1px solid var(--sf-border);
        padding: 28px 0;
        text-align: center;
    }
    .sf-footer-links {
        margin-bottom: 10px;
    }
    .sf-footer-links a {
        font-size: 12px;
        color: var(--sf-text-4);
        text-decoration: none;
        margin: 0 12px;
        transition: color 0.2s;
    }
    .sf-footer-links a:hover { color: var(--sf-purple-light); }
    .sf-footer-copy {
        font-size: 12px;
        color: #3f3f46;
    }

    /* ===== Responsive ===== */
    @media (max-width: 900px) {
        .hero-title { font-size: 30px; }
        .domain-grid { grid-template-columns: repeat(2, 1fr); }
        .bottom-row { grid-template-columns: 1fr; }
        .stats-bar { gap: 24px; flex-wrap: wrap; }
    }
    @media (max-width: 600px) {
        .hero { padding: 36px 16px 20px; }
        .hero-title { font-size: 24px; }
        .hero-subtitle { font-size: 14px; }
        .domain-grid { grid-template-columns: 1fr; }
        .stats-bar { gap: 16px; }
        .stat-value { font-size: 20px; }
        .search-domain-select { display: none; }
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero">
    <div class="hero-badge"><span class="pulse"></span> {{ domains|length + 1 }}ê°œ ì „ë¬¸ ë¶„ì•¼ &middot; AI ì‹¤ì‹œê°„ ê²€ìƒ‰</div>
    <h1 class="hero-title">ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”<br>AIê°€ ì „ë¬¸ ë¬¸ì„œì—ì„œ ì°¾ì•„ë“œë¦½ë‹ˆë‹¤</h1>
    <p class="hero-subtitle">
        ë°˜ë„ì²´ ê¸°ìˆ ë¶€í„° ë…¸ë™ë²•, ì‚°ì—…ì•ˆì „ê¹Œì§€ &mdash;<br>
        <strong>SafeFactory</strong>ê°€ ì¦‰ì‹œ ë‹µë³€ì„ ë“œë¦½ë‹ˆë‹¤
    </p>

    <!-- Unified Search -->
    <div class="search-container">
        <form class="unified-search" id="searchForm" onsubmit="return handleSearch(event)">
            <span class="search-icon">ğŸ”</span>
            <input type="text" class="search-input" id="searchQuery" placeholder="AIì—ê²Œ ì§ˆë¬¸í•˜ì„¸ìš”... (ì˜ˆ: CVDì™€ PVD ê³µì •ì˜ ì°¨ì´ì ì€?)" autocomplete="off">
            <div class="search-domain-select" id="domainSelectWrap">
                <span id="domainSelectLabel">ì „ì²´ ë¶„ì•¼</span> â–¾
                <select id="domainSelect" onchange="document.getElementById('domainSelectLabel').textContent=this.options[this.selectedIndex].text">
                    <option value="">ì „ì²´ ë¶„ì•¼</option>
                    {% for key, cfg in domains.items() %}
                    <option value="{{ key }}">{{ cfg.icon }} {{ cfg.title.split(' ')[0] if ' ' in cfg.title else cfg.title }}</option>
                    {% endfor %}
                </select>
            </div>
            <button type="submit" class="search-submit" aria-label="ê²€ìƒ‰">â†’</button>
        </form>
        <div class="search-hints">
            <span class="search-hint" onclick="fillSearch('CVDì™€ PVD ê³µì •ì˜ ì°¨ì´ì ì€?')">ğŸ’¡ CVDì™€ PVD ì°¨ì´ì </span>
            <span class="search-hint" onclick="fillSearch('ì£¼íœ´ìˆ˜ë‹¹ ê³„ì‚° ë°©ë²•')">ğŸ’¡ ì£¼íœ´ìˆ˜ë‹¹ ê³„ì‚°</span>
            <span class="search-hint" onclick="fillSearch('ì•„ì„¸í†¤ MSDS ì •ë³´')">ğŸ’¡ ì•„ì„¸í†¤ MSDS</span>
            <span class="search-hint" onclick="fillSearch('í˜„ì¥ì‹¤ìŠµ ì¥ë¹„ ì•ˆì „ìˆ˜ì¹™')">ğŸ’¡ ì¥ë¹„ ì•ˆì „ìˆ˜ì¹™</span>
        </div>
    </div>

    <!-- Stats Bar -->
    <div class="stats-bar">
        <div class="stat-item">
            <div class="stat-value" id="statDocs">--</div>
            <div class="stat-label">ì „ì²´ ë¬¸ì„œ</div>
        </div>
        <div class="stat-item">
            <div class="stat-value">{{ domains|length + 1 }}</div>
            <div class="stat-label">ì „ë¬¸ ë¶„ì•¼</div>
        </div>
        <div class="stat-item">
            <div class="stat-value">24/7</div>
            <div class="stat-label">AI ì„œë¹„ìŠ¤</div>
        </div>
        <div class="stat-item">
            <div class="stat-value">&lt; 3ì´ˆ</div>
            <div class="stat-label">í‰ê·  ì‘ë‹µ</div>
        </div>
    </div>
</section>

<!-- Domain Cards -->
<section class="domains-section">
    <h2 class="section-title">ğŸ“š ì „ë¬¸ ë¶„ì•¼</h2>
    <div class="domain-grid">
        <!-- ë°˜ë„ì²´ -->
        <a href="/semiconductor" class="domain-card dc-semi">
            <div class="domain-card-bar"></div>
            <div class="domain-card-body">
                <div class="card-top">
                    <div class="card-icon-wrap">ğŸ”¬</div>
                    <div class="card-doc-count">ğŸ“„ <span class="num" id="docCount-semiconductor">--</span>ê°œ ë¬¸ì„œ</div>
                </div>
                <div class="card-title">ë°˜ë„ì²´ ê¸°ìˆ </div>
                <div class="card-desc">ë°˜ë„ì²´ ê³µì •, ì•„í‚¤í…ì²˜, ì œì¡° ê¸°ìˆ  ê´€ë ¨ ì „ë¬¸ ë¬¸ì„œ ê²€ìƒ‰ ë° AI ì§ˆì˜ì‘ë‹µ</div>
                <div class="card-tags">
                    {% for f in domains.semiconductor.features %}
                    <span class="card-tag">{{ f }}</span>
                    {% endfor %}
                </div>
                <div class="card-action">
                    <span class="card-action-label">ğŸ¤– AI ì§ˆë¬¸í•˜ê¸°</span>
                    <span class="card-action-arrow">â†’</span>
                </div>
            </div>
        </a>

        <!-- ë…¸ë™ë²• -->
        <a href="/laborlaw" class="domain-card dc-labor">
            <div class="domain-card-bar"></div>
            <div class="domain-card-body">
                <div class="card-top">
                    <div class="card-icon-wrap">âš–ï¸</div>
                    <div class="card-doc-count">ğŸ“„ <span class="num" id="docCount-laborlaw">--</span>ê°œ ë¬¸ì„œ</div>
                </div>
                <div class="card-title">ë…¸ë™ë²•</div>
                <div class="card-desc">ê·¼ë¡œê¸°ì¤€ë²•, íŒë¡€, ì„ê¸ˆ ë° ë³´í—˜ë£Œ ê³„ì‚° Â· ë…¸ë™ë²• ê´€ë ¨ AI ë²•ë¥  ìƒë‹´</div>
                <div class="card-tags">
                    {% for f in domains.laborlaw.features %}
                    <span class="card-tag">{{ f }}</span>
                    {% endfor %}
                </div>
                <div class="card-action">
                    <span class="card-action-label">ğŸ¤– AI ì§ˆë¬¸í•˜ê¸°</span>
                    <span class="card-action-arrow">â†’</span>
                </div>
            </div>
        </a>

        <!-- í˜„ì¥ì‹¤ìŠµ -->
        <a href="/field-training" class="domain-card dc-field">
            <div class="domain-card-bar"></div>
            <div class="domain-card-body">
                <div class="card-top">
                    <div class="card-icon-wrap">ğŸ­</div>
                    <div class="card-doc-count">ğŸ“„ <span class="num" id="docCount-field-training">--</span>ê°œ ë¬¸ì„œ</div>
                </div>
                <div class="card-title">í˜„ì¥ì‹¤ìŠµ ì•ˆì „êµìœ¡</div>
                <div class="card-desc">ì§ì—…ê³„ê³  í˜„ì¥ì‹¤ìŠµ ì•ˆì „ë³´ê±´ ê°€ì´ë“œ Â· ì¥ë¹„ë³„ ìœ„í—˜ìš”ì¸ ë° ì•ˆì „ìˆ˜ì¹™</div>
                <div class="card-tags">
                    {% for f in domains['field-training'].features %}
                    <span class="card-tag">{{ f }}</span>
                    {% endfor %}
                </div>
                <div class="card-action">
                    <span class="card-action-label">ğŸ¤– AI ì§ˆë¬¸í•˜ê¸°</span>
                    <span class="card-action-arrow">â†’</span>
                </div>
            </div>
        </a>

        <!-- ì•ˆì „ë³´ê±´ -->
        <a href="/safeguide" class="domain-card dc-safe">
            <div class="domain-card-bar"></div>
            <div class="domain-card-body">
                <div class="card-top">
                    <div class="card-icon-wrap">ğŸ›¡ï¸</div>
                    <div class="card-doc-count">ğŸ“„ <span class="num" id="docCount-safeguide">--</span>ê°œ ë¬¸ì„œ</div>
                </div>
                <div class="card-title">ì•ˆì „ë³´ê±´ ê°€ì´ë“œ</div>
                <div class="card-desc">ì•ˆì „ë³´ê±´ê³µë‹¨ ê³µì‹ ì•ˆì „ë³´ê±´ êµìœ¡ìë£Œ Â· ì‚°ì—… í˜„ì¥ ì•ˆì „ìˆ˜ì¹™ ë° ì˜ˆë°©ëŒ€ì±…</div>
                <div class="card-tags">
                    {% for f in domains.safeguide.features %}
                    <span class="card-tag">{{ f }}</span>
                    {% endfor %}
                </div>
                <div class="card-action">
                    <span class="card-action-label">ğŸ¤– AI ì§ˆë¬¸í•˜ê¸°</span>
                    <span class="card-action-arrow">â†’</span>
                </div>
            </div>
        </a>

        <!-- MSDS -->
        <a href="/msds" class="domain-card dc-msds">
            <div class="domain-card-bar"></div>
            <div class="domain-card-body">
                <div class="card-top">
                    <div class="card-icon-wrap">ğŸ§ª</div>
                    <div class="card-doc-count">ğŸ“„ <span class="num" id="docCount-msds">--</span>ê°œ ë¬¸ì„œ</div>
                </div>
                <div class="card-title">MSDS í™”í•™ë¬¼ì§ˆ</div>
                <div class="card-desc">ì‚°ì—…ì•ˆì „ë³´ê±´ê³µë‹¨ ë¬¼ì§ˆì•ˆì „ë³´ê±´ìë£Œ Â· í™”í•™ë¬¼ì§ˆ ì•ˆì „ì •ë³´ ê²€ìƒ‰</div>
                <div class="card-tags">
                    {% for f in domains.msds.features %}
                    <span class="card-tag">{{ f }}</span>
                    {% endfor %}
                </div>
                <div class="card-action">
                    <span class="card-action-label">ğŸ¤– AI ì§ˆë¬¸í•˜ê¸°</span>
                    <span class="card-action-arrow">â†’</span>
                </div>
            </div>
        </a>

        <!-- ì»¤ë®¤ë‹ˆí‹° -->
        <a href="/community" class="domain-card dc-comm">
            <div class="domain-card-bar"></div>
            <div class="domain-card-body">
                <div class="card-top">
                    <div class="card-icon-wrap">ğŸ’¬</div>
                    <div class="card-doc-count">ğŸ§‘â€ğŸ¤â€ğŸ§‘ ì»¤ë®¤ë‹ˆí‹°</div>
                </div>
                <div class="card-title">ì»¤ë®¤ë‹ˆí‹°</div>
                <div class="card-desc">ì§ˆë¬¸, ì •ë³´ê³µìœ , ììœ ê²Œì‹œíŒ Â· í•¨ê»˜ ì†Œí†µí•˜ëŠ” ì»¤ë®¤ë‹ˆí‹° ê³µê°„</div>
                <div class="card-tags">
                    <span class="card-tag">ì§ˆë¬¸/ë‹µë³€</span>
                    <span class="card-tag">ì •ë³´ê³µìœ </span>
                    <span class="card-tag">ììœ ê²Œì‹œíŒ</span>
                    <span class="card-tag">ê³µì§€ì‚¬í•­</span>
                </div>
                <div class="card-action">
                    <span class="card-action-label">ğŸ’¬ ì»¤ë®¤ë‹ˆí‹° ì…ì¥</span>
                    <span class="card-action-arrow">â†’</span>
                </div>
            </div>
        </a>
    </div>
</section>

<!-- Bottom Row -->
<section class="bottom-row">
    <!-- Community Preview -->
    <div class="bottom-card">
        <div class="bottom-card-header">
            <div class="bottom-card-title">ğŸ’¬ ì»¤ë®¤ë‹ˆí‹° ìµœì‹ ê¸€</div>
            <a href="/community" class="view-all">ì „ì²´ë³´ê¸° â†’</a>
        </div>
        <div id="communityPreview">
            <div class="comm-empty">ë¡œë”© ì¤‘...</div>
        </div>
    </div>

    <!-- News Preview -->
    <div class="bottom-card">
        <div class="bottom-card-header">
            <div class="bottom-card-title">ğŸ“° ë…¸ë™ì•ˆì „ ë‰´ìŠ¤</div>
            <a href="/news" class="view-all">ì „ì²´ë³´ê¸° â†’</a>
        </div>
        <div id="newsPreview">
            <div class="comm-empty">ë¡œë”© ì¤‘...</div>
        </div>
    </div>
</section>

<!-- Footer -->
<footer class="sf-footer">
    <div class="sf-footer-inner">
        <div class="sf-footer-links">
            <a href="#">ì´ìš©ì•½ê´€</a>
            <a href="#">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
            <a href="#">ê³ ê°ì„¼í„°</a>
        </div>
        <p class="sf-footer-copy">&copy; 2025 SafeFactory. AI ê¸°ë°˜ ì‚°ì—…ì•ˆì „ ì§€ì‹ í”Œë«í¼</p>
    </div>
</footer>
{% endblock %}

{% block scripts %}
<script src="/static/js/common.js"></script>
<script>
// Namespace â†’ domain key mapping
const NAMESPACE_MAP = {
    '': 'semiconductor',
    'laborlaw': 'laborlaw',
    'field-training': 'field-training',
    'safeguide': 'safeguide',
    'msds': 'msds'
};

// Domain key â†’ default route mapping
const DOMAIN_ROUTES = {
    '': '/semiconductor',
    'semiconductor': '/semiconductor',
    'laborlaw': '/laborlaw',
    'field-training': '/field-training',
    'safeguide': '/safeguide',
    'msds': '/msds'
};

// Fill search input from hint chips
function fillSearch(text) {
    document.getElementById('searchQuery').value = text;
    document.getElementById('searchQuery').focus();
}

// Handle search form submit
function handleSearch(e) {
    e.preventDefault();
    const query = document.getElementById('searchQuery').value.trim();
    if (!query) return false;
    const domain = document.getElementById('domainSelect').value;
    const route = DOMAIN_ROUTES[domain] || '/semiconductor';
    window.location.href = route + '?q=' + encodeURIComponent(query);
    return false;
}

// Load stats from API
async function loadStats() {
    try {
        const resp = await fetch('/api/stats');
        const data = await resp.json();
        if (data.success && data.data) {
            // Total documents
            const total = data.data.total_vectors || 0;
            document.getElementById('statDocs').textContent = total.toLocaleString();

            // Per-namespace counts
            const namespaces = data.data.namespaces;
            const entries = Array.isArray(namespaces)
                ? namespaces.map(ns => [ns.name || ns.namespace || '', ns])
                : Object.entries(namespaces || {});
            for (const [ns, info] of entries) {
                const norm = (ns === '(ê¸°ë³¸)') ? '' : ns;
                const domainKey = NAMESPACE_MAP[norm];
                if (domainKey) {
                    const el = document.getElementById('docCount-' + domainKey);
                    if (el) el.textContent = (info.vector_count || 0).toLocaleString();
                }
            }
        }
    } catch (e) {
        console.error('Stats load error:', e);
    }
}

// Load news preview
async function loadNewsPreview() {
    try {
        const resp = await fetch('/api/v1/news/articles?per_page=4');
        const data = await resp.json();
        const container = document.getElementById('newsPreview');

        if (data.success && data.data && data.data.articles && data.data.articles.length > 0) {
            const catClasses = {
                'accident': 'nc-accident',
                'regulation': 'nc-regulation',
                'policy': 'nc-policy',
                'technology': 'nc-technology',
                'general': 'nc-general',
            };
            container.innerHTML = data.data.articles.map(function(a) {
                const catClass = catClasses[a.category] || 'nc-general';
                const catLabel = escapeHtml(a.category_label || 'ì¼ë°˜');
                const title = escapeHtml(a.title);
                const source = a.source_name ? escapeHtml(a.source_name) : '';
                return '<a href="/news#article/' + a.id + '" class="news-item">' +
                    '<span class="news-cat ' + catClass + '">' + catLabel + '</span>' +
                    '<span class="news-text">' + title + '</span>' +
                    '<span class="news-meta">' + source + '</span>' +
                    '</a>';
            }).join('');
        } else {
            container.innerHTML = '<div class="comm-empty">ì•„ì§ ë“±ë¡ëœ ë‰´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        }
    } catch (e) {
        console.error('News preview error:', e);
        document.getElementById('newsPreview').innerHTML =
            '<div class="comm-empty">ë‰´ìŠ¤ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
    }
}

// Load community preview
async function loadCommunityPreview() {
    try {
        const resp = await fetch('/api/v1/community/posts?per_page=4&sort=latest');
        const data = await resp.json();
        const container = document.getElementById('communityPreview');

        if (data.success && data.data && data.data.posts && data.data.posts.length > 0) {
            const badgeMap = {
                'ì§ˆë¬¸': 'cb-q', 'ì •ë³´': 'cb-i', 'ììœ ': 'cb-f', 'ê³µì§€': 'cb-n',
                'ì§ˆë¬¸/ë‹µë³€': 'cb-q', 'ì •ë³´ê³µìœ ': 'cb-i', 'ììœ ê²Œì‹œíŒ': 'cb-f', 'ê³µì§€ì‚¬í•­': 'cb-n'
            };
            container.innerHTML = data.data.posts.map(function(p) {
                const catName = (p.category && p.category.name) || 'ììœ ';
                const badgeClass = badgeMap[catName] || 'cb-f';
                const title = escapeHtml(p.title);
                const safeCatName = escapeHtml(catName);
                const comments = p.comment_count || 0;
                return '<a href="/community#post/' + p.id + '" class="comm-item">' +
                    '<span class="comm-badge ' + badgeClass + '">' + safeCatName + '</span>' +
                    '<span class="comm-text">' + title + '</span>' +
                    '<span class="comm-meta"><span>ğŸ’¬ ' + comments + '</span></span>' +
                    '</a>';
            }).join('');
        } else {
            container.innerHTML = '<div class="comm-empty">ì•„ì§ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        }
    } catch (e) {
        console.error('Community preview error:', e);
        document.getElementById('communityPreview').innerHTML =
            '<div class="comm-empty">ì»¤ë®¤ë‹ˆí‹°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
    }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    loadStats();
    loadCommunityPreview();
    loadNewsPreview();
});
</script>
{% endblock %}
